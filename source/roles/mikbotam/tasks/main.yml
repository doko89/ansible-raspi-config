- name: create directory
  file:
    path: /var/www/mikbotam
    state: directory
    owner: www-data
    group: www-data

- name: extract file mikbotam
  unarchive:
    src: files/mikbotam-1.8.tar.gz
    dest: /var/www/mikbotam
    owner: www-data
    group: www-data

- name: setup virtualhost mikbotam
  template:
    src: mikbotam.conf.j2
    dest: /etc/nginx/conf.d/mikbotam.conf
  register: vhost_mikbotam

- name: restart nginx service
  systemd:
    name: nginx
    state: restarted
  when: vhost_mikbotam.changed

- name: polling configuration
  template:
    src: mikbotam-polling.conf.j2
    dest: /etc/supervisor/conf.d/mikbotam-polling.conf
  register: polling

- name: restart supervisor service
  systemd:
    name: supervisor
    state: restarted
  when: polling.changed

- include: mysql-setup.yml

- include: sqlite-setup.yml
